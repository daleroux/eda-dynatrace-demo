---
- name: Watching for Problems on Dynatrace
  hosts: all
  sources:
    - dynatrace.event_driven_ansible.dt_esa_api:
        dt_api_host: "{{ dynatrace_host }}"
        dt_api_token: "{{ dynatrace_token }}"
        delay: "{{ dynatrace_delay }}"

  rules:
    - name: Problem payload Dynatrace for CPU saturation issue
      condition: event.title contains "CPU saturation"
      action:
        debug:
          msg: " CPU saturation"
          extra_vars:
            dynatrace_host: !vault |
                            $ANSIBLE_VAULT;1.1;AES256
                            39656166333632383361366565373530373635386264336661333463343966613264643334326435
                            6465303935343630396339396666653961633930343461320a663630353132653362663661336461
                            35303836633231353364373630323839653066633338376436393934343830383961626239633863
                            6235336630666537310a386463306531343334386139333530313338346137653736663665353962
                            30653234306238343032613732636333333135336339663539613362376437383931303137363533
                            6161343837373063396161326132623132356163633666633430
            dynatrace_token: !vault |
                             $ANSIBLE_VAULT;1.1;AES256
                             30393933303530633361343363366461616363353232323437613266663332353261333432386463
                             6334306636643162366265623863333935366536313637300a643637373435333761346563643436
                             61613131333839306465366632313130346239393964303734326130633264643262653265373461
                             6262613338373531390a373862343162303531303563613061376630326538383939333230373863
                             61373866336661343231396230326661623236333239373739303865333230653538303361336266
                             64303732353935373739643631346437333338326635653963643231386630323438663636303136
                             37666335383831653363383937626638613939336133386135383437353931336238356531313162
                             39393132653634393439323730376332363638363834383532373762393934393966316133323365
            dynatrace_delay: 60
